resources:
- name: pipeline-scripts
  type: git
  source:
    branch: master
    uri: {{git-project-url}}
# - name: trigger-daily-after-1am
#   type: time
#   source:
#     start: 1:00 AM -0500
#     stop: 3:00 AM -0500

jobs:
- name: get-all-orgs
  serial: true
  public: true
  plan:
  - get: pipeline-scripts
    trigger: false
  # - get: trigger-daily-after-1am
  #   trigger: true
  - task: get-orgs-and-quotas
    file: pipeline-scripts/ci/tasks/get-orgs-and-quotas.yml
    params:
      PCF_API_ENDPOINT: {{pcf-api-endpoint}}
      PCF_APPS_DOMAIN: {{pcf-apps-domain}}
      SYS_ADMIN_USER: {{pcf-sys-admin-user}}
      SYS_ADMIN_PASSWORD: {{pcf-sys-admin-user-password}}

  - task: get-apps-and-services-usage
    file: pipeline-scripts/ci/tasks/get-apps-and-services-usage.yml
    params:
      PCF_API_ENDPOINT: {{pcf-api-endpoint}}
      PCF_APPS_DOMAIN: {{pcf-apps-domain}}
      SYS_ADMIN_USER: {{pcf-sys-admin-user}}
      SYS_ADMIN_PASSWORD: {{pcf-sys-admin-user-password}}

  - task: consolidate-usage-data
    file: pipeline-scripts/ci/tasks/consolidate-usage-data.yml


  # - task: get-service-usage-for-each-org
  #   file: pipeline-scripts/ci/tasks/get-services-usage.yml
  #   params:
  #     PCF_API_ENDPOINT: {{pcf-api-endpoint}}
  #     PCF_APPS_DOMAIN: {{pcf-apps-domain}}
  #     SYS_ADMIN_USER: {{pcf-sys-admin-user}}
  #     SYS_ADMIN_PASSWORD: {{pcf-sys-admin-user-password}}

# - name: backup-elastic-runtime
#   serial: true
#   public: true
#   plan:
#   - get: pcf-backup-scripts
#     trigger: false
#   - get: trigger-daily-after-1am
#     trigger: true
#     passed:
#       - backup-opsman
#   - task: backup-elastic-runtime
#     file: pcf-backup-scripts/pcf-cfops-backup/ci/tasks/cfops_backup.yml
